import{_ as l,P as u,Q as r,Z as a,S as n,a0 as s,$ as p,a1 as t,D as i}from"./framework-5062c97b.js";const d={},k=n("h1",{id:"pwa",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#pwa","aria-hidden":"true"},"#"),s(" pwa")],-1),v={href:"https://developer.mozilla.org/zh-CN/docs/Web/Progressive_web_apps",target:"_blank",rel:"noopener noreferrer"},m={href:"https://developers.google.com/web/tools/workbox/modules/workbox-build",target:"_blank",rel:"noopener noreferrer"},h={href:"https://github.com/yyx990803/register-service-worker",target:"_blank",rel:"noopener noreferrer"},b=t(`<h2 id="使用方法" tabindex="-1"><a class="header-anchor" href="#使用方法" aria-hidden="true">#</a> 使用方法</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">npm</span> i <span class="token parameter variable">-D</span> @vuepress/plugin-pwa@next
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> pwaPlugin <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vuepress/plugin-pwa&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token function">pwaPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token comment">// 配置项</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="web-app-manifests" tabindex="-1"><a class="header-anchor" href="#web-app-manifests" aria-hidden="true">#</a> Web App Manifests</h2>`,4),g={href:"https://developer.mozilla.org/zh-CN/docs/Web/Manifest",target:"_blank",rel:"noopener noreferrer"},_=n("code",null,".vuepress/public",-1),f=t(`<ol><li>创建 Manifest 文件</li></ol><p>通常是 <code>.vuepress/public/manifest.webmanifest</code> ：</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;VuePress&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;short_name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;VuePress&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Vue-powered Static Site Generator&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;start_url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/index.html&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;display&quot;</span><span class="token operator">:</span> <span class="token string">&quot;standalone&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;background_color&quot;</span><span class="token operator">:</span> <span class="token string">&quot;#fff&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;theme_color&quot;</span><span class="token operator">:</span> <span class="token string">&quot;#3eaf7c&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;icons&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;src&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/images/icons/android-chrome-192x192.png&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;sizes&quot;</span><span class="token operator">:</span> <span class="token string">&quot;192x192&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;image/png&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;src&quot;</span><span class="token operator">:</span> <span class="token string">&quot;/images/icons/android-chrome-384x384.png&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;sizes&quot;</span><span class="token operator">:</span> <span class="token string">&quot;384x384&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;image/png&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>生成 PWA 图标</li></ol><p>为了提高你的 PWA 的可用性，你需要生成一些图标，并将它们放置在 Public 目录下。</p><p>确保图标的路径匹配 Manifest 文件中的 <code>icons</code> 字段：</p><ul><li><code>.vuepress/public/images/icons/android-chrome-192x192.png</code></li><li><code>.vuepress/public/images/icons/android-chrome-384x384.png</code></li></ul>`,7),q={class:"hint-container tip"},w=n("p",{class:"hint-container-title"},"提示",-1),y={href:"https://realfavicongenerator.net/",target:"_blank",rel:"noopener noreferrer"},x=n("ol",{start:"3"},[n("li",null,"设置 Head 中的标签")],-1),W={href:"https://developer.mozilla.org/en-US/docs/Web/Manifest#deploying_a_manifest_with_the_link_tag",target:"_blank",rel:"noopener noreferrer"},S=t(`<div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  head<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token string">&quot;link&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> rel<span class="token operator">:</span> <span class="token string">&quot;manifest&quot;</span><span class="token punctuation">,</span> href<span class="token operator">:</span> <span class="token string">&quot;/manifest.webmanifest&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token string">&quot;meta&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;theme-color&quot;</span><span class="token punctuation">,</span> content<span class="token operator">:</span> <span class="token string">&quot;#3eaf7c&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token comment">// ...其他标签</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="配置项" tabindex="-1"><a class="header-anchor" href="#配置项" aria-hidden="true">#</a> 配置项</h2>`,2),P={href:"https://developers.google.com/web/tools/workbox/reference-docs/latest/module-workbox-build#.generateSW",target:"_blank",rel:"noopener noreferrer"},z=n("code",null,"globDirectory",-1),E=n("code",null,"swDest",-1),A=t(`<p>比如，你可以设置 <code>skipWaiting: true</code> ，这将在新的 Service Worker 就绪之后立即激活它：</p><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token function">pwaPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      skipWaiting<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>但是如果你不设置 <code>skipWaiting</code> 或设置为 <code>false</code> ，你就需要手动激活新的 Service Worker 。</p>`,3),B=n("li",null,[s("对于开发者，你可以使用该插件提供的 "),n("a",{href:"#composition-api"},"Composition API"),s(" 来控制 Service Worker 的行为。")],-1),M=n("h3",{id:"serviceworkerfilename",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#serviceworkerfilename","aria-hidden":"true"},"#"),s(" serviceWorkerFilename")],-1),N=n("li",null,[n("p",null,[s("类型： "),n("code",null,"string")])],-1),V=n("li",null,[n("p",null,[s("默认值： "),n("code",null,"'service-worker.js'")])],-1),C=n("p",null,"详情：",-1),I=n("p",null,[s("Service Worker 文件只会在 "),n("code",null,"build"),s(" 模式下生成。")],-1),j=n("h2",{id:"composition-api",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#composition-api","aria-hidden":"true"},"#"),s(" Composition API")],-1),D=n("h3",{id:"usepwaevent",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#usepwaevent","aria-hidden":"true"},"#"),s(" usePwaEvent")],-1),L=n("p",null,"详情：",-1),R=n("p",null,"返回该插件的 Event Emitter 。",-1),G={href:"https://github.com/yyx990803/register-service-worker",target:"_blank",rel:"noopener noreferrer"},F=n("li",null,[n("p",null,"示例：")],-1),U=t(`<div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> usePwaEvent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vuepress/plugin-pwa/client&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> event <span class="token operator">=</span> <span class="token function">usePwaEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    event<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;ready&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>registration<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Service worker 已经生效。&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="useskipwaiting" tabindex="-1"><a class="header-anchor" href="#useskipwaiting" aria-hidden="true">#</a> useSkipWaiting</h3><ul><li>参数：</li></ul><table><thead><tr><th>参数</th><th>类型</th><th>描述</th></tr></thead><tbody><tr><td>registration</td><td><code>ServiceWorkerRegistration</code></td><td>你想要激活的 Service Worker 的 Registration</td></tr></tbody></table>`,4),H=n("p",null,"详情：",-1),Q={href:"https://developer.mozilla.org/en-US/docs/Web/API/ServiceWorkerGlobalScope/skipWaiting",target:"_blank",rel:"noopener noreferrer"},T=n("li",null,[n("p",null,"示例：")],-1),Z=t(`<div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> usePwaEvent<span class="token punctuation">,</span> useSkipWaiting <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vuepress/plugin-pwa/client&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> event <span class="token operator">=</span> <span class="token function">usePwaEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    event<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;updated&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>registration<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;在 Waiting 状态的 Service Worker 已经就绪。&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 激活 Waiting 状态的 Service Worker</span>
      <span class="token function">useSkipWaiting</span><span class="token punctuation">(</span>registration<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,1);function $(J,K){const c=i("NpmBadge"),e=i("ExternalLinkIcon"),o=i("RouterLink");return u(),r("div",null,[k,a(c,{package:"@vuepress/plugin-pwa"}),n("p",null,[s("使你的 VuePress 站点成为一个 "),n("a",v,[s("渐进式 Web 应用 (PWA)"),a(e)]),s(".")]),n("p",null,[s("该插件使用 "),n("a",m,[s("workbox-build"),a(e)]),s(" 来生成 Service Worker 文件，并通过 "),n("a",h,[s("register-service-worker"),a(e)]),s(" 来注册 Service Worker 。")]),b,n("p",null,[s("为了使你的网站符合 PWA 的要求，你需要创建一个 "),n("a",g,[s("Web app manifests"),a(e)]),s(" 文件，并且为你的 PWA 设置图标、颜色等信息。")]),n("p",null,[s("你需要将你的 Manifest 文件和图标放置在 "),a(o,{to:"/zh/guide/assets.html#public-%E6%96%87%E4%BB%B6"},{default:p(()=>[s("Public 目录")]),_:1}),s(" 下。在下述的示例中，我们假设你正在使用默认的 Public 目录 "),_,s(" 。")]),f,n("div",q,[w,n("p",null,[s("一些工具可以帮助你做这些事。比如 "),n("a",y,[s("Favicon Generator"),a(e)]),s(" 可以帮助你生成图片以及一个 Manifest 文件样例。")])]),x,n("p",null,[s("你还需要通过 "),a(o,{to:"/zh/reference/config.html#head"},{default:p(()=>[s("head")]),_:1}),s(" 配置项来设置一些标签，用来 "),n("a",W,[s("部署你的 Manifest 文件"),a(e)]),s(" 。")]),S,n("p",null,[s("该插件的配置项可以接收 workbox-build 中 "),n("a",P,[s("generateSW 方法"),a(e)]),s(" 除了 "),z,s(" 和 "),E,s(" 以外的所有参数。")]),A,n("ul",null,[n("li",null,[s("对于用户，你可以配合我们提供的 "),a(o,{to:"/zh/reference/plugin/pwa-popup.html"},{default:p(()=>[s("pwa-popup")]),_:1}),s(" 插件一起使用。")]),B]),M,n("ul",null,[N,V,n("li",null,[C,n("p",null,[s("生成的 Service Worker 文件路径，该路径是 "),a(o,{to:"/zh/reference/config.html#dest"},{default:p(()=>[s("dest")]),_:1}),s(" 目录的相对路径。")]),I])]),j,D,n("ul",null,[n("li",null,[L,R,n("p",null,[s("你可以为 "),n("a",G,[s("register-service-worker"),a(e)]),s(" 提供的事件添加事件监听器。")])]),F]),U,n("ul",null,[n("li",null,[H,n("p",null,[s("调用 "),n("a",Q,[s("skipWaiting()"),a(e)]),s(" 来激活处于 Waiting 状态的 Service Worker 。")])]),T]),Z])}const X=l(d,[["render",$],["__file","pwa.html.vue"]]);export{X as default};
